<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weight360</title>
  <meta name="theme-color" content="#0f1724">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--muted:#94a3b8;--gold:#ffd166;color-scheme:dark}
    /* Layout fix: use normal block flow so the page scrolls naturally */
    html,body{margin:0;background:linear-gradient(180deg,#071026 0%, #071827 100%);color:#e6eef8;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:980px;margin:16px auto;padding:0 14px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:1.15rem;margin:0}
    .tiny{font-size:.9rem}.muted{color:var(--muted)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    input,button{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
      background:transparent;color:inherit;min-height:40px}
    input[type="date"]{min-width:140px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .grow{flex:1 1 280px}
    .right{margin-left:auto}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.06)}
    .section-title{font-size:1rem;margin:0 0 6px}
    /* Chart fix: set a firm height so it never runs down the page */
    #chartWrap{position:relative}
    canvas#weightChart{display:block;width:100% !important;max-height:320px;height:320px !important}
    .chart-row{display:flex;gap:12px;align-items:flex-start}
    .stats{flex:1 1 35%;display:flex;flex-direction:column;gap:8px}
    .stat{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
    .bar{height:10px;border-radius:8px;background:#1f2a44;overflow:hidden}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--gold),#fca5a5);width:0%}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.06);font-size:.95rem}
    @media(max-width:780px){.chart-row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Weight360</h1>
        <div class="tiny muted">Private weight & calorie tracker — saved locally on this device</div>
      </div>
      <div class="tiny muted pill">Goal: <b id="hdrGoal">—</b></div>
    </header>

    <!-- FOOD & CALORIES — moved to the TOP -->
    <section class="card" id="foodTop">
      <h2 class="section-title">Food & Calories</h2>
      <div class="row">
        <div><label class="tiny muted">Date</label><br/><input type="date" id="foodDate"></div>
        <div class="grow"><label class="tiny muted">Food</label><br/><input id="foodName" placeholder="eggs & toast"></div>
        <div><label class="tiny muted">Calories</label><br/><input type="number" id="foodCals" placeholder="320"></div>
        <div><button id="addFood">Add food</button></div>
        <div class="right">
          <label class="tiny muted">Maintenance kcal/day</label><br/>
          <input type="number" id="maintKcal" placeholder="auto" style="width:160px">
          <button id="autoMaint" title="Rough estimate: 12 × current weight">Auto</button>
        </div>
      </div>
      <div class="row tiny" style="margin-top:8px">
        <span class="pill">Today total: <b id="todayTotal">0</b> kcal</span>
        <span class="pill">Remaining vs max: <b id="todayRemain">—</b></span>
      </div>
      <div style="overflow:auto;max-height:240px;margin-top:10px">
        <table id="foodTable">
          <thead><tr><th>Date</th><th>Food</th><th>Calories</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- TOP CONTROLS (weight + goal) -->
    <section class="card">
      <div class="row">
        <div class="grow">
          <label class="tiny muted">Date</label><br/>
          <input type="date" id="date">
        </div>
        <div>
          <label class="tiny muted">Weight (lbs)</label><br/>
          <input type="number" step="0.1" id="weight" placeholder="e.g. 238.6">
        </div>
        <div class="grow">
          <label class="tiny muted">Notes</label><br/>
          <input type="text" id="notes" placeholder="morning weigh-in, gym, etc.">
        </div>
        <div>
          <button id="addWeight">Add</button>
          <button id="saveWeight" style="display:none">Save</button>
        </div>

        <!-- Goal controls (edit/clear) -->
        <div class="right">
          <label class="tiny muted">Goal (lbs)</label><br/>
          <div class="row" style="gap:6px">
            <input type="number" step="0.1" id="goal" placeholder="190" style="width:120px">
            <button id="saveGoal">Set</button>
            <button id="clearGoal" title="Clear saved goal">Clear</button>
          </div>
        </div>
      </div>
      <div class="row tiny muted" style="margin-top:8px">
        <span>Target date: <b id="targetDateLbl">Jan 1, 2026</b></span>
        <span class="pill">Max calories/day to hit goal: <b id="maxCalPerDay">—</b></span>
        <button id="recalc" class="right">Recalculate</button>
      </div>
    </section>

    <!-- CHART + STATS -->
    <section class="card chart-row">
      <div id="chartWrap" class="grow">
        <canvas id="weightChart"></canvas>
        <div class="tiny muted" style="margin-top:6px">Progress toward goal</div>
        <div class="bar"><span id="progressBar"></span></div>
        <div class="tiny muted" id="progressLabel" style="margin-top:4px">0%</div>
      </div>
      <div class="stats">
        <div class="stat"><div class="tiny muted">First recorded</div><div id="firstVal">—</div></div>
        <div class="stat"><div class="tiny muted">Latest</div><div id="latestVal">—</div></div>
        <div class="stat"><div class="tiny muted">Change</div><div id="changeVal">—</div></div>
        <div class="stat"><div class="tiny muted">Avg/week</div><div id="rateVal">—</div></div>
        <div class="stat"><div class="tiny muted">Days left</div><div id="daysLeftVal">—</div></div>
        <div class="row" style="gap:6px">
          <button id="exportCsv">Export CSV</button>
          <input type="file" id="importCsv" accept=".csv" />
        </div>
      </div>
    </section>

    <!-- WEIGHT ENTRIES -->
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 class="section-title">Weight Entries</h2>
        <div class="tiny muted">Click a row to edit</div>
      </div>
      <div style="overflow:auto;max-height:260px">
        <
